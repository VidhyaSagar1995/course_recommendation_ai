<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Course Recommendation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-container, .recommendations {
            margin-bottom: 20px;
        }
        .form-toggle {
            margin-bottom: 10px;
        }
        .form-toggle button {
            margin-right: 10px;
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .recommendation {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
        }
        .recommendation h3 {
            margin: 0 0 10px;
        }
        .recommendation p {
            margin: 5px 0;
        }
        .feedback-buttons button {
            margin-right: 10px;
        }
        #structured-form {
            display: block;
        }
        #paragraph-form {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Student Course Recommendation</h1>

    <div class="form-container">
        <div class="form-toggle">
            <button onclick="showStructuredForm()">Switch to Structured Input</button>
            <button onclick="showParagraphForm()">Switch to Paragraph Input</button>
        </div>

        <form id="structured-form">
            <label for="name">Name: *</label>
            <input type="text" id="name" required>

            <label for="background">Current Background:</label>
            <textarea id="background"></textarea>

            <label for="interests">Interests (comma separated): *</label>
            <input type="text" id="interests" required>

            <label for="previous-courses">Previous Courses (comma separated IDs):</label>
            <input type="text" id="previous-courses">

            <label for="goals">Career Goals:</label>
            <textarea id="goals"></textarea>

            <label for="skill-levels">Self-rated Skill Levels:</label>
            <textarea id="skill-levels"></textarea>
        </form>

        <form id="paragraph-form">
            <label for="para-name">Name: *</label>
            <input type="text" id="para-name" required>

            <label for="profile-paragraph">Profile Paragraph: *</label>
            <textarea id="profile-paragraph" required></textarea>
        </form>

        <button onclick="getRecommendations()">Get Recommendations</button>
    </div>

    <div class="recommendations" id="recommendations">
        <h2>Recommended Courses</h2>
        <div id="recommendation-list"></div>
    </div>

    <script>
        function showStructuredForm() {
            document.getElementById('structured-form').style.display = 'block';
            document.getElementById('paragraph-form').style.display = 'none';
        }

        function showParagraphForm() {
            document.getElementById('structured-form').style.display = 'none';
            document.getElementById('paragraph-form').style.display = 'block';
        }

        async function getRecommendations() {
            const structuredForm = document.getElementById('structured-form');
            let data;
            if (structuredForm.style.display !== 'none') {
                data = {
                    name: document.getElementById('name').value,
                    background: document.getElementById('background').value,
                    interests: document.getElementById('interests').value.split(',').map(i => i.trim()),
                    previous_courses: document.getElementById('previous-courses').value.split(',').map(c => c.trim()).filter(c => c),
                    goals: document.getElementById('goals').value,
                    skill_levels: document.getElementById('skill-levels').value || null
                };
            } else {
                data = {
                    name: document.getElementById('para-name').value,
                    profile_paragraph: document.getElementById('profile-paragraph').value
                };
            }

            try {
                const response = await fetch('http://127.0.0.1:8000/recommend', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                displayRecommendations(result.recommended_courses, data.name);
            } catch (error) {
                console.error('Error fetching recommendations:', error);
                alert('Failed to fetch recommendations. Please try again.');
            }
        }

        function displayRecommendations(courses, userId) {
            const recommendationList = document.getElementById('recommendation-list');
            recommendationList.innerHTML = '';
            courses.forEach(course => {
                const div = document.createElement('div');
                div.className = 'recommendation';
                div.innerHTML = `
                    <h3>${course.title}</h3>
                    <p><strong>Provider:</strong> ${course.provider}</p>
                    <p><strong>Description:</strong> ${course.description}</p>
                    <p><strong>Skill Level:</strong> ${course.skill_level}</p>
                    <p><strong>Duration:</strong> ${course.duration}</p>
                    <p><strong>Tags:</strong> ${course.tags.join(', ')}</p>
                    <p><a href="${course.url}" target="_blank">Course Link</a></p>
                    <div class="feedback-buttons">
                        <button onclick="submitFeedback('${userId}', '${course.id}', 'like')">Like</button>
                        <button onclick="submitFeedback('${userId}', '${course.id}', 'dislike')">Dislike</button>
                    </div>
                `;
                recommendationList.appendChild(div);
            });
        }

        async function submitFeedback(userId, courseId, feedback) {
            try {
                const response = await fetch('http://127.0.0.1:8000/feedback', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, course_id: courseId, feedback })
                });
                const result = await response.json();
                alert(result.message);
            } catch (error) {
                console.error('Error submitting feedback:', error);
                alert('Failed to submit feedback. Please try again.');
            }
        }
    </script>
</body>
</html>